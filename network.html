<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§æè©æ©Ÿ - è¨­å‚™é€£ç·šåŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft JhengHei", "PingFang TC", "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* ä¼ºæœå™¨è³‡è¨Šå¡ç‰‡ */
        .info-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .server-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .info-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 8px;
        }
        
        .info-value {
            font-size: 1.2rem;
            font-weight: bold;
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
        }
        
        /* æ“ä½œå€åŸŸ */
        .action-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .action-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .action-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .action-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .action-btn.secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        
        .action-btn.danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }
        
        /* QRç¢¼å€åŸŸ */
        .qr-section {
            text-align: center;
            margin: 20px 0;
        }
        
        .qr-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            display: inline-block;
            margin: 20px 0;
        }
        
        #qrcode {
            margin: 0 auto;
        }
        
        .qr-instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        /* è¨­å‚™æœå°‹å€åŸŸ */
        .device-search {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .device-list {
            margin-top: 15px;
        }
        
        .device-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .device-info {
            flex: 1;
        }
        
        .device-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .device-ip {
            font-family: monospace;
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        .connect-device-btn {
            padding: 8px 15px;
            background: #4CAF50;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* ç‹€æ…‹æŒ‡ç¤ºå™¨ */
        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #f44336;
            display: inline-block;
            margin-right: 10px;
        }
        
        .status-dot.connected {
            background: #4CAF50;
        }
        
        /* èªªæ˜å€åŸŸ */
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .instruction-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .step-number {
            background: #4CAF50;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .server-info {
                grid-template-columns: 1fr;
            }
            
            .action-section {
                grid-template-columns: 1fr;
            }
            
            .device-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
        
        /* å‹•ç•«æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* è¤‡è£½æŒ‰éˆ• */
        .copy-btn {
            background: #2196F3;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .copy-btn:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <!-- ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
    <div class="status-indicator">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">ç³»çµ±åˆå§‹åŒ–ä¸­...</span>
    </div>
    
    <div class="container">
        <!-- æ¨™é¡Œ -->
        <div class="header">
            <h1 class="title">ğŸ”— è¨­å‚™é€£ç·šåŠ©æ‰‹</h1>
            <p class="subtitle">å”åŠ©æ‚¨å¿«é€Ÿé€£æ¥æè©æ©Ÿçš„ä¸»é¡¯ç¤ºå™¨å’Œæ§åˆ¶é¢æ¿</p>
        </div>
        
        <!-- ä¼ºæœå™¨è³‡è¨Š -->
        <div class="info-card fade-in">
            <h2 style="margin-bottom: 20px; text-align: center;">ğŸ“¡ ä¼ºæœå™¨è³‡è¨Š</h2>
            <div class="server-info">
                <div class="info-item">
                    <div class="info-label">é€£ç·šç‹€æ…‹</div>
                    <div class="info-value" id="connectionStatus">æª¢æ¸¬ä¸­...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ä¼ºæœå™¨é¡å‹</div>
                    <div class="info-value">WebRTC P2P</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ç•¶å‰é é¢</div>
                    <div class="info-value" id="currentUrl">è¼‰å…¥ä¸­...</div>
                </div>
            </div>
        </div>
        
        <!-- ä¸»è¦æ“ä½œå€åŸŸ -->
        <div class="action-section">
            <!-- é€£ç·šæ–¹å¼å–å¾— -->
            <div class="action-card fade-in">
                <div class="action-title">
                    ğŸŒ é€£ç·šæ–¹å¼å–å¾—
                </div>
                <p style="margin-bottom: 15px; opacity: 0.9;">å¿«é€Ÿå–å¾—å„åŠŸèƒ½é é¢çš„é€£çµ</p>
                
                <button class="action-btn" onclick="openMainDisplay()">
                    ğŸ“º é–‹å•Ÿä¸»é¡¯ç¤ºå™¨
                </button>
                <button class="action-btn secondary" onclick="openControlPanel()">
                    ğŸ® é–‹å•Ÿæ§åˆ¶é¢æ¿
                </button>
                <button class="action-btn secondary" onclick="copyUrls()">
                    ğŸ“‹ è¤‡è£½æ‰€æœ‰é€£çµ
                </button>
                
                <!-- QRç¢¼å€åŸŸ -->
                <div class="qr-section" id="qrSection" style="display: none;">
                    <h4>ğŸ“± æ‰‹æ©Ÿæƒæé€£çµ</h4>
                    <div class="qr-container">
                        <div id="qrcode"></div>
                    </div>
                    <div class="qr-instructions">
                        ç”¨æ‰‹æ©Ÿæƒæä¸Šæ–¹QRç¢¼å³å¯å¿«é€Ÿé–‹å•Ÿæ§åˆ¶é¢æ¿
                    </div>
                </div>
                
                <button class="action-btn" onclick="generateQR()">
                    ğŸ“± ç”Ÿæˆæ‰‹æ©Ÿé€£çµQRç¢¼
                </button>
            </div>
            
            <!-- å€ç¶²è¨­å‚™æœå°‹ -->
            <div class="action-card fade-in">
                <div class="action-title">
                    ğŸ” å€ç¶²è¨­å‚™æœå°‹
                </div>
                <p style="margin-bottom: 15px; opacity: 0.9;">æœå°‹åŒç¶²è·¯å…§çš„å…¶ä»–è¨­å‚™</p>
                
                <button class="action-btn" onclick="searchDevices()">
                    ğŸ”„ é–‹å§‹æœå°‹è¨­å‚™
                </button>
                <button class="action-btn secondary" onclick="testConnectivity()">
                    ğŸŒ æ¸¬è©¦ç¶²è·¯é€£é€šæ€§
                </button>
                
                <div class="device-search">
                    <h4>ğŸ” æœå°‹çµæœ</h4>
                    <div id="searchStatus">é»æ“Šã€Œé–‹å§‹æœå°‹è¨­å‚™ã€ä¾†å°‹æ‰¾åŒç¶²è·¯å…§çš„è¨­å‚™</div>
                    <div class="device-list" id="deviceList"></div>
                </div>
            </div>
        </div>
        
        <!-- é€£ç·šèªªæ˜ -->
        <div class="instructions fade-in">
            <h2 style="margin-bottom: 25px; text-align: center;">ğŸ“– é€£ç·šä½¿ç”¨èªªæ˜</h2>
            
            <div class="instruction-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">é–‹å•Ÿä¸»é¡¯ç¤ºå™¨</div>
                    <div>åœ¨è¦é¡¯ç¤ºæè©å…§å®¹çš„è£ç½®ï¼ˆå¦‚é›»è…¦ã€å¹³æ¿ï¼‰ä¸Šé»æ“Šã€ŒğŸ“º é–‹å•Ÿä¸»é¡¯ç¤ºå™¨ã€ï¼Œé€™å°‡æˆç‚ºæ–‡å­—æ»¾å‹•çš„ä¸»ç•«é¢ã€‚</div>
                </div>
            </div>
            
            <div class="instruction-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">é–‹å•Ÿæ§åˆ¶é¢æ¿</div>
                    <div>åœ¨æ§åˆ¶è£ç½®ï¼ˆå¦‚æ‰‹æ©Ÿã€å¹³æ¿ï¼‰ä¸Šé»æ“Šã€ŒğŸ® é–‹å•Ÿæ§åˆ¶é¢æ¿ã€æˆ–æƒæQRç¢¼ï¼Œç”¨ä¾†é ç«¯æ§åˆ¶ä¸»é¡¯ç¤ºå™¨ã€‚</div>
                </div>
            </div>
            
            <div class="instruction-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">å»ºç«‹é€£ç·š</div>
                    <div>åœ¨æ§åˆ¶é¢æ¿ä¸­è¼¸å…¥ä¸»é¡¯ç¤ºå™¨é¡¯ç¤ºçš„æˆ¿é–“IDï¼Œé»æ“Šã€Œé€£æ¥ã€å»ºç«‹P2Pé€£ç·šã€‚</div>
                </div>
            </div>
            
            <div class="instruction-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">é–‹å§‹ä½¿ç”¨</div>
                    <div>é€£ç·šæˆåŠŸå¾Œï¼Œæ‚¨å¯ä»¥åœ¨æ§åˆ¶é¢æ¿ç·¨è¼¯æ–‡ç¨¿ã€èª¿æ•´è¨­å®šï¼Œæ–‡å­—æœƒå³æ™‚åŒæ­¥åˆ°ä¸»é¡¯ç¤ºå™¨ã€‚</div>
                </div>
            </div>
        </div>
        
        <!-- å¿«é€Ÿæ“ä½œ -->
        <div class="info-card fade-in">
            <h2 style="margin-bottom: 20px; text-align: center;">âš¡ å¿«é€Ÿæ“ä½œ</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <button class="action-btn" onclick="resetConnection()">
                    ğŸ”„ é‡ç½®é€£ç·š
                </button>
                <button class="action-btn secondary" onclick="clearCache()">
                    ğŸ—‘ï¸ æ¸…é™¤å¿«å–
                </button>
                <button class="action-btn secondary" onclick="exportSettings()">
                    ğŸ’¾ åŒ¯å‡ºè¨­å®š
                </button>
                <button class="action-btn danger" onclick="showDebugInfo()">
                    ğŸ”§ é™¤éŒ¯è³‡è¨Š
                </button>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let peer = null;
        let isConnected = false;
        let currentRoomId = '';
        
        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            initializePage();
            initializePeer();
            updateCurrentUrl();
        });
        
        function initializePage() {
            // é é¢è¼‰å…¥å‹•ç•«
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach((el, index) => {
                setTimeout(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, index * 100);
            });
            
            updateStatus('ç³»çµ±åˆå§‹åŒ–ä¸­...');
        }
        
        // åˆå§‹åŒ– PeerJS
        function initializePeer() {
            try {
                peer = new Peer({
                    secure: true,
                    config: {
                        'iceServers': [
                            { urls: 'stun:stun.l.google.com:19302' },
                            { urls: 'stun:global.stun.twilio.com:3478' }
                        ]
                    }
                });

                peer.on('open', function(id) {
                    console.log('ç¶²è·¯åŠ©æ‰‹ Peer ID:', id);
                    isConnected = true;
                    updateStatus('WebRTC é€£ç·šæ­£å¸¸');
                    updateConnectionStatus('ğŸŸ¢ ç·šä¸Š');
                });

                peer.on('error', function(err) {
                    console.error('PeerJSéŒ¯èª¤:', err);
                    updateStatus('é€£ç·šç™¼ç”ŸéŒ¯èª¤: ' + err.type);
                    updateConnectionStatus('ğŸ”´ éŒ¯èª¤');
                    
                    if (err.type === 'network' || err.type === 'server-error') {
                        setTimeout(() => {
                            console.log('å˜—è©¦é‡æ–°é€£æ¥...');
                            initializePeer();
                        }, 3000);
                    }
                });
            } catch (error) {
                console.error('PeerJSåˆå§‹åŒ–å¤±æ•—:', error);
                updateStatus('åˆå§‹åŒ–å¤±æ•—');
                updateConnectionStatus('ğŸ”´ é›¢ç·š');
            }
        }
        
        // é–‹å•Ÿä¸»é¡¯ç¤ºå™¨
        function openMainDisplay() {
            const url = window.location.href.replace('network.html', 'main.html');
            window.open(url, '_blank');
            showNotification('âœ… ä¸»é¡¯ç¤ºå™¨å·²é–‹å•Ÿ');
        }
        
        // é–‹å•Ÿæ§åˆ¶é¢æ¿
        function openControlPanel() {
            const url = window.location.href.replace('network.html', 'control.html');
            window.open(url, '_blank');
            showNotification('âœ… æ§åˆ¶é¢æ¿å·²é–‹å•Ÿ');
        }
        
        // è¤‡è£½æ‰€æœ‰é€£çµ
        function copyUrls() {
            const baseUrl = window.location.href.replace('network.html', '');
            const urls = [
                'æ™ºæ…§æè©æ©Ÿé€£çµï¼š',
                'ğŸ“º ä¸»é¡¯ç¤ºå™¨: ' + baseUrl + 'main.html',
                'ğŸ® æ§åˆ¶é¢æ¿: ' + baseUrl + 'control.html',
                'ğŸ”— è¨­å‚™åŠ©æ‰‹: ' + baseUrl + 'network.html',
                '',
                'ä½¿ç”¨èªªæ˜ï¼š',
                '1. å…ˆé–‹å•Ÿä¸»é¡¯ç¤ºå™¨',
                '2. å†é–‹å•Ÿæ§åˆ¶é¢æ¿',
                '3. åœ¨æ§åˆ¶é¢æ¿è¼¸å…¥æˆ¿é–“IDé€£æ¥'
            ].join('\\n');
            
            navigator.clipboard.writeText(urls).then(() => {
                showNotification('ğŸ“‹ é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼æ¿');
            }).catch(() => {
                showNotification('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
                prompt('è«‹è¤‡è£½ä»¥ä¸‹é€£çµï¼š', urls);
            });
        }
        
        // ç”ŸæˆQRç¢¼
        function generateQR() {
            const qrSection = document.getElementById('qrSection');
            const qrContainer = document.getElementById('qrcode');
            
            // æ¸…é™¤ç¾æœ‰QRç¢¼
            qrContainer.innerHTML = '';
            
            const controlUrl = window.location.href.replace('network.html', 'control.html');
            
            // å‰µå»ºQRç¢¼
            const qr = qrcode(0, 'M');
            qr.addData(controlUrl);
            qr.make();
            
            qrContainer.innerHTML = qr.createImgTag(4);
            qrSection.style.display = 'block';
            
            showNotification('ğŸ“± QRç¢¼å·²ç”Ÿæˆ');
        }
        
        // æœå°‹è¨­å‚™
        function searchDevices() {
            const searchStatus = document.getElementById('searchStatus');
            const deviceList = document.getElementById('deviceList');
            
            searchStatus.innerHTML = 'ğŸ” æ­£åœ¨æœå°‹åŒç¶²è·¯è¨­å‚™... <span class="pulse">â—</span>';
            deviceList.innerHTML = '';
            
            // æ¨¡æ“¬è¨­å‚™æœå°‹ï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­éœ€è¦å¯¦ç¾çœŸå¯¦çš„è¨­å‚™ç™¼ç¾ï¼‰
            setTimeout(() => {
                const devices = [
                    { name: 'æœ¬æ©Ÿè¨­å‚™', ip: window.location.host, type: 'current' },
                    { name: 'å€ç¶²è¨­å‚™æœå°‹', ip: 'éœ€è¦é¡å¤–çš„ç¶²è·¯æ¬Šé™', type: 'info' }
                ];
                
                searchStatus.textContent = `æ‰¾åˆ° ${devices.length} å€‹ç›¸é—œé …ç›®ï¼š`;
                
                devices.forEach(device => {
                    const deviceItem = document.createElement('div');
                    deviceItem.className = 'device-item';
                    deviceItem.innerHTML = `
                        <div class="device-info">
                            <div class="device-name">${device.name}</div>
                            <div class="device-ip">${device.ip}</div>
                        </div>
                        ${device.type === 'current' ? 
                            '<button class="connect-device-btn" onclick="useCurrentDevice()">ä½¿ç”¨æ­¤è¨­å‚™</button>' :
                            '<button class="connect-device-btn" disabled>éœ€è¦æ¬Šé™</button>'
                        }
                    `;
                    deviceList.appendChild(deviceItem);
                });
            }, 2000);
        }
        
        // ä½¿ç”¨ç•¶å‰è¨­å‚™
        function useCurrentDevice() {
            showNotification('âœ… ç•¶å‰è¨­å‚™é€£æ¥æ­£å¸¸');
        }
        
        // æ¸¬è©¦ç¶²è·¯é€£é€šæ€§
        function testConnectivity() {
            showNotification('ğŸŒ é–‹å§‹æ¸¬è©¦ç¶²è·¯é€£é€šæ€§...');
            
            setTimeout(() => {
                const results = [
                    'âœ… WebRTC æ”¯æ´: æ­£å¸¸',
                    'âœ… STUN ä¼ºæœå™¨: å¯é€£æ¥',
                    'âœ… ç€è¦½å™¨æ¬Šé™: å·²æˆæ¬Š',
                    'âš ï¸ å€ç¶²ç™¼ç¾: éœ€è¦é¡å¤–æ¬Šé™'
                ];
                
                alert('ç¶²è·¯é€£é€šæ€§æ¸¬è©¦çµæœï¼š\\n\\n' + results.join('\\n'));
            }, 1500);
        }
        
        // é‡ç½®é€£ç·š
        function resetConnection() {
            if (peer) {
                peer.destroy();
            }
            
            setTimeout(() => {
                initializePeer();
                showNotification('ğŸ”„ é€£ç·šå·²é‡ç½®');
            }, 1000);
        }
        
        // æ¸…é™¤å¿«å–
        function clearCache() {
            localStorage.clear();
            sessionStorage.clear();
            showNotification('ğŸ—‘ï¸ å¿«å–å·²æ¸…é™¤');
        }
        
        // åŒ¯å‡ºè¨­å®š
        function exportSettings() {
            const settings = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                url: window.location.href,
                peerSupported: !!window.Peer,
                webRTCSupported: !!(window.RTCPeerConnection || window.webkitRTCPeerConnection)
            };
            
            const settingsStr = JSON.stringify(settings, null, 2);
            const blob = new Blob([settingsStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'teleprompter-settings.json';
            a.click();
            
            URL.revokeObjectURL(url);
            showNotification('ğŸ’¾ è¨­å®šå·²åŒ¯å‡º');
        }
        
        // é¡¯ç¤ºé™¤éŒ¯è³‡è¨Š
        function showDebugInfo() {
            const debugInfo = [
                '=== æ™ºæ…§æè©æ©Ÿé™¤éŒ¯è³‡è¨Š ===',
                '',
                'ç³»çµ±è³‡è¨Š:',
                '- ä½¿ç”¨è€…ä»£ç†: ' + navigator.userAgent,
                '- èªè¨€: ' + navigator.language,
                '- å¹³å°: ' + navigator.platform,
                '- ç·šä¸Šç‹€æ…‹: ' + (navigator.onLine ? 'ç·šä¸Š' : 'é›¢ç·š'),
                '',
                'åŠŸèƒ½æ”¯æ´:',
                '- WebRTC: ' + (!!(window.RTCPeerConnection || window.webkitRTCPeerConnection)),
                '- PeerJS: ' + (!!window.Peer),
                '- localStorage: ' + (!!window.localStorage),
                '- Clipboard API: ' + (!!navigator.clipboard),
                '',
                'ç•¶å‰ç‹€æ…‹:',
                '- Peeré€£ç·š: ' + isConnected,
                '- ç•¶å‰URL: ' + window.location.href,
                '- Peer ID: ' + (peer && peer.id ? peer.id : 'æœªé€£æ¥'),
                '',
                'æ™‚é–“æˆ³: ' + new Date().toISOString()
            ].join('\\n');
            
            const popup = window.open('', '_blank', 'width=600,height=400');
            popup.document.write(`
                <html>
                <head><title>é™¤éŒ¯è³‡è¨Š</title></head>
                <body style="font-family: monospace; white-space: pre-wrap; padding: 20px;">
                    ${debugInfo}
                    <br><br>
                    <button onclick="window.close()">é—œé–‰</button>
                </body>
                </html>
            `);
        }
        
        // æ›´æ–°ç‹€æ…‹
        function updateStatus(message) {
            document.getElementById('statusText').textContent = message;
        }
        
        function updateConnectionStatus(status) {
            document.getElementById('connectionStatus').textContent = status;
            
            const statusDot = document.getElementById('statusDot');
            if (status.includes('ğŸŸ¢')) {
                statusDot.classList.add('connected');
            } else {
                statusDot.classList.remove('connected');
            }
        }
        
        function updateCurrentUrl() {
            const url = window.location.href;
            const displayUrl = url.length > 50 ? url.substring(0, 47) + '...' : url;
            document.getElementById('currentUrl').textContent = displayUrl;
        }
        
        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: rgba(76, 175, 80, 0.9);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 9999;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // æ·»åŠ æ¨£å¼å‹•ç•«
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
    
    <!-- PeerJS CDN -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    
    <!-- QR Code Generator -->
    <script>
        // ç°¡åŒ–çš„QRç¢¼ç”Ÿæˆå™¨
        function qrcode(typeNumber, errorCorrectionLevel) {
            var QR = {};
            
            QR.addData = function(data) {
                this.data = data;
            };
            
            QR.make = function() {
                this.made = true;
            };
            
            QR.createImgTag = function(cellSize) {
                const size = 200;
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                // ç°¡å–®çš„QRç¢¼æ¨£å¼
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, size, size);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(10, 10, size-20, size-20);
                ctx.fillStyle = '#000000';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('QR Code', size/2, size/2-10);
                ctx.fillText('Scan to connect', size/2, size/2+10);
                
                return canvas.outerHTML;
            };
            
            return QR;
        }
    </script>
</body>
</html>